import os
from datetime import datetime
from jinja2 import Environment, FileSystemLoader
from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas

def generate_html_report(url, results, output_file="report.html"):
    """
    Generates an HTML report.
    """
    env = Environment(loader=FileSystemLoader('.'))
    template = env.get_template('report_template.html')
    report_data = {
        "url": url,
        "date": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "results": results
    }
    html_content = template.render(report_data)
    with open(output_file, "w") as file:
        file.write(html_content)
    print(f"HTML report generated: {output_file}")

def generate_pdf_report(url, results, output_file="report.pdf"):
    """
    Generates a PDF report.
    """
    c = canvas.Canvas(output_file, pagesize=letter)
    width, height = letter
    c.setFont("Helvetica", 12)

    y = height - 40
    c.drawString(30, y, "Vulnerability Scan Report")
    y -= 20
    c.drawString(30, y, f"URL: {url}")
    y -= 20
    c.drawString(30, y, f"Date: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    y -= 30

    c.setFont("Helvetica-Bold", 12)
    c.drawString(30, y, "Check")
    c.drawString(300, y, "Result")
    c.setFont("Helvetica", 12)
    y -= 20

    for check, result in results.items():
        if y < 40:
            c.showPage()
            c.setFont("Helvetica", 12)
            y = height - 40
        c.drawString(30, y, check)
        c.drawString(300, y, result)
        y -= 20

    c.save()
    print(f"PDF report generated: {output_file}")

if __name__ == "__main__":
    test_url = "http://example.com"
    test_results = {
        "SQL Injection": "No vulnerability found.",
        "XSS": "Vulnerable",
        "CSRF": "No vulnerability found.",
        "Open Ports": "Ports 80, 443 open.",
        "Directory Traversal": "No vulnerability found.",
        "Security Headers": "Missing Content-Security-Policy."
    }

    generate_html_report(test_url, test_results)
    generate_pdf_report(test_url, test_results)
